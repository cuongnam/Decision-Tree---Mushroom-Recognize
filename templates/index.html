<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üçÑ D·ª± ƒëo√°n n·∫•m: Odor + Cap-Color + Gill-Color</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --danger:#ef4444; }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(120deg,#0b1023,#0f172a);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text)}
    .wrap{max-width:900px;margin:24px auto;padding:16px}
    .card{background:rgba(17,24,39,.8);backdrop-filter: blur(8px);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px;font-size:28px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media (min-width:720px){.grid{grid-template-columns:repeat(3,1fr)}}
    label{display:block;font-weight:600;margin-bottom:8px}
    select, input[type="file"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1222;color:var(--text)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#1f2937;color:var(--text);cursor:pointer;font-weight:600}
    .btn:hover{background:#111827}
    .btn-primary{background:#16a34a;border-color:#16a34a}
    .btn-primary:hover{background:#15803d}
    .status{font-size:14px;color:var(--muted)}
    .result{margin-top:16px;padding:14px 16px;border-radius:12px;border:1px dashed rgba(255,255,255,.15);display:flex;justify-content:space-between;align-items:center}
    .badge{padding:6px 10px;border-radius:999px;font-weight:700}
    .ok{background:rgba(34,197,94,.15);color:#86efac;border:1px solid rgba(34,197,94,.35)}
    .bad{background:rgba(239,68,68,.15);color:#fecaca;border:1px solid rgba(239,68,68,.35)}
    .warn{background:rgba(234,179,8,.15);color:#fde68a;border:1px solid rgba(234,179,8,.35)}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    details{margin-top:16px;color:var(--muted)}
    code,kbd{background:#0b1222;border:1px solid rgba(255,255,255,.1);padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üçÑ D·ª± ƒëo√°n n·∫•m (3 thu·ªôc t√≠nh)</h1>
      <p class="lead">Ch·ªçn <strong>m√πi (odor)</strong>, <strong>m√†u m≈© (cap-color)</strong>, <strong>m√†u phi·∫øn (gill-color)</strong> v√† t·∫£i m√¥ h√¨nh c√¢y quy·∫øt ƒë·ªãnh (ƒë·ªãnh d·∫°ng JSON) ƒë·ªÉ d·ª± ƒëo√°n <em>edible</em> hay <em>poisonous</em>.</p>

      <div class="row" style="margin: 10px 0 18px">
        <label for="modelFile" class="status">üì¶ M√¥ h√¨nh: <span id="modelStatus">ch∆∞a t·∫£i</span></label>
        <input id="modelFile" type="file" accept="application/json" />
        <button class="btn" id="btnSample">D√°n JSON m·∫´u</button>
      </div>

      <div class="grid">
        <div>
          <label for="odor">M√πi (odor)</label>
          <select id="odor">
            <option value="">‚Äî Ch·ªçn m√πi ‚Äî</option>
          </select>
          <div class="hint">M√£ ‚Üí m√¥ t·∫£. V√≠ d·ª•: <kbd>n</kbd> = kh√¥ng m√πi (none)</div>
        </div>
        <div>
          <label for="cap">M√†u m≈© n·∫•m (cap-color)</label>
          <select id="cap">
            <option value="">‚Äî Ch·ªçn m√†u m≈© ‚Äî</option>
          </select>
        </div>
        <div>
          <label for="gill">M√†u phi·∫øn n·∫•m (gill-color)</label>
          <select id="gill">
            <option value="">‚Äî Ch·ªçn m√†u phi·∫øn ‚Äî</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:18px">
        <button class="btn btn-primary" id="predictBtn">üîÆ D·ª± ƒëo√°n</button>
        <button class="btn" id="resetBtn">‚Ü∫ X√≥a ch·ªçn</button>
      </div>

      <div id="result" class="result" style="display:none">
        <div id="resultText">K·∫øt qu·∫£‚Ä¶</div>
        <div id="resultBadge" class="badge"></div>
      </div>


    </div>
  </div>

  <script>
    // --- Danh s√°ch gi√° tr·ªã (m√£ ‚Üí m√¥ t·∫£) ---
    const odorMap = {
      a: 'a - h·∫°nh nh√¢n (almond)', l: 'l - h·ªìi (anise)', c: 'c - creosote (nh·ª±a g·ªó)',
      y: 'y - c√° (fishy)', f: 'f - h√¥i (foul)', m: 'm - m·ªëc (musty)',
      n: 'n - kh√¥ng m√πi (none)', p: 'p - cay (pungent)', s: 's - cay n·ªìng (spicy)'
    };
    const capMap = {
      n: 'n - n√¢u (brown)', b: 'b - be (buff)', c: 'c - qu·∫ø (cinnamon)', g: 'g - x√°m (gray)',
      r: 'r - xanh l·ª•c (green)', p: 'p - h·ªìng (pink)', u: 'u - t√≠m (purple)', e: 'e - ƒë·ªè (red)',
      w: 'w - tr·∫Øng (white)', y: 'y - v√†ng (yellow)'
    };
    const gillMap = {
      k: 'k - ƒëen (black)', n: 'n - n√¢u (brown)', b: 'b - be (buff)', h: 'h - chocolate',
      g: 'g - x√°m (gray)', r: 'r - xanh l·ª•c (green)', o: 'o - cam (orange)', p: 'p - h·ªìng (pink)',
      u: 'u - t√≠m (purple)', e: 'e - ƒë·ªè (red)', w: 'w - tr·∫Øng (white)', y: 'y - v√†ng (yellow)'
    };

    // --- Ti·ªán √≠ch DOM ---
    const $ = (s) => document.querySelector(s);
    const odorSel = $('#odor');
    const capSel  = $('#cap');
    const gillSel = $('#gill');
    const resBox  = $('#result');
    const resText = $('#resultText');
    const resBadge= $('#resultBadge');
    const modelStatus = $('#modelStatus');

    function fillOptions(select, map){
      for(const [val, label] of Object.entries(map)){
        const opt = document.createElement('option');
        opt.value = val; opt.textContent = label; select.appendChild(opt);
      }
    }
    fillOptions(odorSel, odorMap);
    fillOptions(capSel, capMap);
    fillOptions(gillSel, gillMap);

    // --- Model (Decision Tree) ---
    // S·∫Ω ƒë∆∞·ª£c n·∫°p t·ª´ .json do ng∆∞·ªùi d√πng ch·ªçn
    let modelTree = null;

    // T·∫£i JSON t·ª´ input file
    document.getElementById('modelFile').addEventListener('change', async (e)=>{
      const file = e.target.files?.[0];
      if(!file){ modelStatus.textContent = 'ch∆∞a t·∫£i'; modelTree = null; return; }
      try{
        const text = await file.text();
        const obj = JSON.parse(text);
        if(typeof obj !== 'object' || obj === null) throw new Error('JSON kh√¥ng h·ª£p l·ªá');
        modelTree = obj;
        modelStatus.textContent = `ƒë√£ t·∫£i: ${file.name}`;
        modelStatus.style.color = '#86efac';
      }catch(err){
        modelTree = null;
        modelStatus.textContent = 'l·ªói khi t·∫£i m√¥ h√¨nh';
        modelStatus.style.color = '#fecaca';
        alert('Kh√¥ng th·ªÉ ƒë·ªçc m√¥ h√¨nh JSON: ' + err.message);
      }
    });

    // D√°n JSON m·∫´u (ch·ªâ ƒë·ªÉ th·ª≠ UI). B·∫°n n√™n thay b·∫±ng m√¥ h√¨nh th·∫≠t.
    document.getElementById('btnSample').addEventListener('click', ()=>{
      // V√≠ d·ª• m·ªôt c√¢y r·∫•t nh·ªè (KH√îNG ph·∫£i m√¥ h√¨nh ch√≠nh x√°c). Ch·ªâ minh h·ªça c·∫•u tr√∫c.
      modelTree = {
        "odor": {
          "n": { "cap-color": { "w": "e", "y": "p", "n": "e" } },
          "f": "p",
          "y": "p",
          "p": "p",
          "a": { "gill-color": { "k": "p", "w": "e" } }
        }
      };
      modelStatus.textContent = 'ƒë√£ n·∫°p JSON m·∫´u (demo)';
      modelStatus.style.color = '#fde68a';
      alert('ƒê√£ n·∫°p c√¢y m·∫´u demo. H√£y d√πng m√¥ h√¨nh th·∫≠t (.json) ƒë·ªÉ c√≥ ƒë·ªô ch√≠nh x√°c cao.');
    });

    // --- H√†m d·ª± ƒëo√°n (ƒë·ªá quy) ---
    function predict(tree, sample){
      if(tree === null || typeof tree !== 'object') return tree; // leaf
      const feature = Object.keys(tree)[0];
      const branches = tree[feature];
      const value = sample[feature];
      if(Object.prototype.hasOwnProperty.call(branches, value)){
        return predict(branches[value], sample);
      } else {
        return 'unknown';
      }
    }

    // --- X·ª≠ l√Ω n√∫t D·ª± ƒëo√°n ---
    document.getElementById('predictBtn').addEventListener('click', ()=>{
      if(!modelTree){ alert('Vui l√≤ng t·∫£i m√¥ h√¨nh (.json) tr∆∞·ªõc.'); return; }
      const odor = odorSel.value, cap = capSel.value, gill = gillSel.value;
      if(!odor || !cap || !gill){ alert('Vui l√≤ng ch·ªçn ƒë·ªß 3 thu·ªôc t√≠nh.'); return; }

      const sample = { 'odor': odor, 'cap-color': cap, 'gill-color': gill };
      const yhat = predict(modelTree, sample);

      let text = '‚ö†Ô∏è Kh√¥ng x√°c ƒë·ªãnh';
      let cls  = 'warn';
      if(yhat === 'e'){ text = 'üçÑ N·∫•m ƒÉn ƒë∆∞·ª£c (Edible)'; cls='ok'; }
      else if(yhat === 'p'){ text = '‚ò†Ô∏è N·∫•m ƒë·ªôc (Poisonous)'; cls='bad'; }

      resText.textContent = text;
      resBadge.className = 'badge ' + cls;
      resBadge.textContent = (yhat||'unknown').toString();
      resBox.style.display = 'flex';
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      odorSel.value = capSel.value = gillSel.value = '';
      resBox.style.display = 'none';
    });
  </script>
</body>
</html>
